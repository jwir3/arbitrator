<!doctype html>
<html>
  <head>
    <title>Arbitrator</title>
    <script src="script/modules/jquery.js"></script>
    <script src="https://apis.google.com/js/client.js"></script>
    <script src="script/modules/sha1.js"></script>
    <script type="text/javascript" src="script/arbitrator.js"></script>
    <script type="text/javascript" src="script/game.js"></script>
    <script type="text/javascript" src="script/ui.js"></script>
    <link rel="stylesheet" href="style/arbitrator.css" type="text/css" />
    <script>
    function populateCalendarList() {
      gapi.client.load('calendar', 'v3', function() {
        var request = gapi.client.calendar.calendarList.list({
        });

        request.execute(function(aResponse) {
          var selectEle = document.getElementById('calendarList');
          for (calendarIdx in aResponse.items) {
              var calendarItem = aResponse.items[calendarIdx];
              var listItem = document.createElement('option');
              listItem.id = calendarItem.id;
              listItem.text = calendarItem.summary;
              selectEle.appendChild(listItem);
          }
          selectEle.style.display = 'block';
        });
      });
    }

    function handleAuthResult(authResult) {
      if (authResult && !authResult.error) {
        populateCalendarList();
      }
    }

    function initAuth() {
      var config = {
        'client_id': '609265890429-c5d69skkd9o2f1fksco00294oom2burf.apps.googleusercontent.com',
        'scope': 'https://www.googleapis.com/auth/calendar',
        'authuser' : -1
      };
      gapi.auth.authorize(config, handleAuthResult);
      if (Arbitrator.hasAliasedGroups()) {
        showAliases();
      }
    }

    function arbitrate() {
      var scheduleText = document.getElementById('schedule').value;
      var arb = new Arbitrator(scheduleText);
      var calSelectionElement = document.getElementById('calendarList');
      var selectedId = calSelectionElement[calSelectionElement.selectedIndex].id;
      arb.adjustGamesOrSubmitToCalendar(selectedId);

      $("#prefArea").show();
    }

    $(document).ready(function() {
      initAuth();
    });

    </script>
  </head>
  <body>
    <div id="messageContainer" class="hidden"><div id="message"></div><div class="instructions">Click to Dismiss</div></div>
    <textarea id="schedule" rows="30" cols="80">Cut and paste your schedule here.</textarea>
    <br />
    <select id="calendarList" style="display: none">
      <option id="noCalendarSelectedOption">Select Calendar</option>
    </select>
    <br />
    <button id="arbitrate-button" onclick="arbitrate();">Submit</button>
    <div id="prefArea">
      <h2>Preferences</h2>
      <hr>
      <div class="prefGroup" id="aliasPrefs">
        <h4>Group Aliases</h4>
        You can add aliases for specific groups here so they are more readable in your calendar.
      </div>
    </div>
  </body>
</html>
