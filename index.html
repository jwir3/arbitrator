<!doctype html>
<html>
  <head>
    <title>Arbitrator</title>
    <style>
      #map-canvas {
        height: 300px;
        width: 300px;
        border: 1px solid blue;
      }
    </style>
    <script src="https://apis.google.com/js/client.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDkiyjtUnxlzQUyxnu0WqUtkhyV8Q2KyA0"></script>
    <script type="text/javascript" src="script/arbitrator.js"></script>
    <script type="text/javascript" src="script/game.js"></script>
    <script>
      function populateCalendarList() {
        gapi.client.load('calendar', 'v3', function() {
          var request = gapi.client.calendar.calendarList.list({
          });

          request.execute(function(aResponse) {
            var selectEle = document.getElementById('calendarList');
            for (calendarIdx in aResponse.items) {
                var calendarItem = aResponse.items[calendarIdx];
                var listItem = document.createElement('option');
                listItem.id = calendarItem.id;
                listItem.text = calendarItem.summary;
                selectEle.appendChild(listItem);
            }
            selectEle.style.display = 'block';
          });
        });
      }

      function handleAuthResult(authResult) {
        if (authResult && !authResult.error) {
          populateCalendarList();
        }
      }

      function initMaps() {
         var mapOptions = {
           center: new google.maps.LatLng(-34.397, 150.644),
           zoom: 8
         };
         var map = new google.maps.Map(document.getElementById("map-canvas"),mapOptions);
      }

      function initAuth() {
        var config = {
          'client_id': '609265890429-c5d69skkd9o2f1fksco00294oom2burf.apps.googleusercontent.com',
          'scope': 'https://www.googleapis.com/auth/calendar',
          'authuser' : -1
        };
        gapi.auth.authorize(config, handleAuthResult);
      }

      function arbitrate() {
        var scheduleText = document.getElementById('schedule').value;
        var arb = new Arbitrator(scheduleText);
        var calSelectionElement = document.getElementById('calendarList');
        console.log(calSelectionElement);
        var selectedId = calSelectionElement[calSelectionElement.selectedIndex].id;
        console.log("Selected index is: " + selectedId);
        arb.submitGamesToCalendar(selectedId);
      }

      // Load the map immediately.
      google.maps.event.addDomListener(window, 'load', initMaps);

    </script>
  </head>
  <body onload="initAuth()">
    <textarea id="schedule" rows="30" cols="80">Cut and paste your schedule here.</textarea>
    <br />
    <select id="calendarList" style="display: none">
      <option id="noCalendarSelectedOption">Select Calendar</option>
    </select>
    <br />
    <button id="arbitrate-button" onclick="arbitrate();">Parse</button>
    <br />
    <br />
    <div id="map-canvas"></div>
  </body>
</html>
